"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),n=require("@aws-amplify/notifications"),t=require("@aws-amplify/core"),o=require("@aws-amplify/ui"),s=require("@aws-amplify/ui-react-core");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=r(e);const i=e.createContext(null),{InAppMessaging:c}=n.Notifications;function p(){const n=e.useContext(i);if(!n)throw new Error("InAppMessagingContext is empty, did you forget the InAppMessagingProvider?");return n}function l(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)n.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(t[o[s]]=e[o[s]])}return t}const u=new t.ConsoleLogger("Notifications.InAppMessaging"),g={BOTTOM_BANNER:"bottom",MIDDLE_BANNER:"middle",TOP_BANNER:"top"},f=e=>g[e],M=(e,n,t)=>{var{action:o,url:s}=e,r=l(e,["action","url"]);return Object.assign(Object.assign({},r),((e,n,t)=>({onAction(){try{n(e)}catch(e){u.error(`Message action failure: ${e}`)}finally{t()}}}))({action:o,url:s},n,t))},y=(e,n,t)=>{const o={};if(!e)return o;const{primaryButton:s,secondaryButton:r}=e,a=l(e,["primaryButton","secondaryButton"]);return s&&(o.primaryButton=M(s,n,t)),r&&(o.secondaryButton=M(r,n,t)),Object.assign(Object.assign({},o),a)},d=Object.freeze({}),A=new t.ConsoleLogger("Notifications.InAppMessaging"),{InAppMessaging:O}=n.Notifications;const E=new t.ConsoleLogger("Notifications.InAppMessaging");exports.InAppMessagingProvider=function({children:n}){const[t,o]=e.useState(null);e.useEffect((()=>{const e=c.onMessageReceived((e=>{o(e)}));return e.remove}),[]);const s=e.useCallback((()=>{o(null)}),[]),r=e.useMemo((()=>({clearMessage:s,displayMessage:o,message:t})),[s,t]);return a.default.createElement(i.Provider,{value:r},n)},exports.handleMessageAction=({action:e,handleMessageLinkAction:n,url:t})=>{if(E.info(`Handle action: ${e}`),"LINK"===e||"DEEP_LINK"===e){if(!o.isString(t))return void E.warn(`url must be of type string. Received: ${t}`);n(t)}},exports.useInAppMessaging=p,exports.useMessage=function({components:e,onMessageAction:t}){const{clearMessage:r,message:a}=p(),{BannerMessage:i,CarouselMessage:c,FullScreenMessage:l,ModalMessage:u}=e;if(o.isNil(a))return{Component:s.RenderNothing,props:d};const{content:g,layout:M}=a,E=()=>{O.notifyMessageInteraction(a,n.InAppMessageInteractionEvent.MESSAGE_ACTION_TAKEN),r()},I=()=>{O.notifyMessageInteraction(a,n.InAppMessageInteractionEvent.MESSAGE_DISMISSED),r()},m=()=>{O.notifyMessageInteraction(a,n.InAppMessageInteractionEvent.MESSAGE_DISPLAYED)};switch(M){case"BOTTOM_BANNER":case"MIDDLE_BANNER":case"TOP_BANNER":return{Component:i,props:Object.assign(Object.assign({},y(null==g?void 0:g[0],t,E)),{layout:M,onClose:I,onDisplay:m,position:f(M)})};case"CAROUSEL":return{Component:c,props:{data:null==g?void 0:g.map((e=>y(e,t,E))),layout:M,onClose:I,onDisplay:m}};case"FULL_SCREEN":return{Component:l,props:Object.assign(Object.assign({},y(null==g?void 0:g[0],t,E)),{layout:M,onClose:I,onDisplay:m})};case"MODAL":return{Component:u,props:Object.assign(Object.assign({},y(null==g?void 0:g[0],t,E)),{layout:M,onClose:I,onDisplay:m})};default:return A.info(`Received unknown InAppMessage layout: ${M}`),{Component:s.RenderNothing,props:d}}};

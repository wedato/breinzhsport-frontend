{"ast":null,"code":"import sortFeatures from './sort_features.js';\nimport mapEventToBoundingBox from './map_event_to_bounding_box.js';\nimport * as Constants from '../constants.js';\nimport StringSet from './string_set.js';\nconst META_TYPES = [Constants.meta.FEATURE, Constants.meta.MIDPOINT, Constants.meta.VERTEX];\n\n// Requires either event or bbox\nexport default {\n  click: featuresAtClick,\n  touch: featuresAtTouch\n};\nfunction featuresAtClick(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.clickBuffer);\n}\nfunction featuresAtTouch(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.touchBuffer);\n}\nfunction featuresAt(event, bbox, ctx, buffer) {\n  if (ctx.map === null) return [];\n  const box = event ? mapEventToBoundingBox(event, buffer) : bbox;\n  const queryParams = {};\n  if (ctx.options.styles) queryParams.layers = ctx.options.styles.map(s => s.id).filter(id => ctx.map.getLayer(id) != null);\n  const features = ctx.map.queryRenderedFeatures(box, queryParams).filter(feature => META_TYPES.indexOf(feature.properties.meta) !== -1);\n  const featureIds = new StringSet();\n  const uniqueFeatures = [];\n  features.forEach(feature => {\n    const featureId = feature.properties.id;\n    if (featureIds.has(featureId)) return;\n    featureIds.add(featureId);\n    uniqueFeatures.push(feature);\n  });\n  return sortFeatures(uniqueFeatures);\n}","map":{"version":3,"names":["sortFeatures","mapEventToBoundingBox","Constants","StringSet","META_TYPES","meta","FEATURE","MIDPOINT","VERTEX","click","featuresAtClick","touch","featuresAtTouch","event","bbox","ctx","featuresAt","options","clickBuffer","touchBuffer","buffer","map","box","queryParams","styles","layers","s","id","filter","getLayer","features","queryRenderedFeatures","feature","indexOf","properties","featureIds","uniqueFeatures","forEach","featureId","has","add","push"],"sources":["C:/Users/jonat/aws_poc/frontend/node_modules/@mapbox/mapbox-gl-draw/src/lib/features_at.js"],"sourcesContent":["import sortFeatures from './sort_features.js';\nimport mapEventToBoundingBox from './map_event_to_bounding_box.js';\nimport * as Constants from '../constants.js';\nimport StringSet from './string_set.js';\n\nconst META_TYPES = [\n  Constants.meta.FEATURE,\n  Constants.meta.MIDPOINT,\n  Constants.meta.VERTEX\n];\n\n// Requires either event or bbox\nexport default {\n  click: featuresAtClick,\n  touch: featuresAtTouch\n};\n\nfunction featuresAtClick(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.clickBuffer);\n}\n\nfunction featuresAtTouch(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.touchBuffer);\n}\n\nfunction featuresAt(event, bbox, ctx, buffer) {\n  if (ctx.map === null) return [];\n\n  const box = (event) ? mapEventToBoundingBox(event, buffer) : bbox;\n\n  const queryParams = {};\n\n  if (ctx.options.styles) queryParams.layers = ctx.options.styles.map(s => s.id).filter(id => ctx.map.getLayer(id) != null);\n\n  const features = ctx.map.queryRenderedFeatures(box, queryParams)\n    .filter(feature => META_TYPES.indexOf(feature.properties.meta) !== -1);\n\n  const featureIds = new StringSet();\n  const uniqueFeatures = [];\n  features.forEach((feature) => {\n    const featureId = feature.properties.id;\n    if (featureIds.has(featureId)) return;\n    featureIds.add(featureId);\n    uniqueFeatures.push(feature);\n  });\n\n  return sortFeatures(uniqueFeatures);\n}\n"],"mappings":"AAAA,OAAOA,YAAY,MAAM,oBAAoB;AAC7C,OAAOC,qBAAqB,MAAM,gCAAgC;AAClE,OAAO,KAAKC,SAAS,MAAM,iBAAiB;AAC5C,OAAOC,SAAS,MAAM,iBAAiB;AAEvC,MAAMC,UAAU,GAAG,CACjBF,SAAS,CAACG,IAAI,CAACC,OAAO,EACtBJ,SAAS,CAACG,IAAI,CAACE,QAAQ,EACvBL,SAAS,CAACG,IAAI,CAACG,MAAM,CACtB;;AAED;AACA,eAAe;EACbC,KAAK,EAAEC,eAAe;EACtBC,KAAK,EAAEC;AACT,CAAC;AAED,SAASF,eAAeA,CAACG,KAAK,EAAEC,IAAI,EAAEC,GAAG,EAAE;EACzC,OAAOC,UAAU,CAACH,KAAK,EAAEC,IAAI,EAAEC,GAAG,EAAEA,GAAG,CAACE,OAAO,CAACC,WAAW,CAAC;AAC9D;AAEA,SAASN,eAAeA,CAACC,KAAK,EAAEC,IAAI,EAAEC,GAAG,EAAE;EACzC,OAAOC,UAAU,CAACH,KAAK,EAAEC,IAAI,EAAEC,GAAG,EAAEA,GAAG,CAACE,OAAO,CAACE,WAAW,CAAC;AAC9D;AAEA,SAASH,UAAUA,CAACH,KAAK,EAAEC,IAAI,EAAEC,GAAG,EAAEK,MAAM,EAAE;EAC5C,IAAIL,GAAG,CAACM,GAAG,KAAK,IAAI,EAAE,OAAO,EAAE;EAE/B,MAAMC,GAAG,GAAIT,KAAK,GAAIZ,qBAAqB,CAACY,KAAK,EAAEO,MAAM,CAAC,GAAGN,IAAI;EAEjE,MAAMS,WAAW,GAAG,CAAC,CAAC;EAEtB,IAAIR,GAAG,CAACE,OAAO,CAACO,MAAM,EAAED,WAAW,CAACE,MAAM,GAAGV,GAAG,CAACE,OAAO,CAACO,MAAM,CAACH,GAAG,CAACK,CAAC,IAAIA,CAAC,CAACC,EAAE,CAAC,CAACC,MAAM,CAACD,EAAE,IAAIZ,GAAG,CAACM,GAAG,CAACQ,QAAQ,CAACF,EAAE,CAAC,IAAI,IAAI,CAAC;EAEzH,MAAMG,QAAQ,GAAGf,GAAG,CAACM,GAAG,CAACU,qBAAqB,CAACT,GAAG,EAAEC,WAAW,CAAC,CAC7DK,MAAM,CAACI,OAAO,IAAI5B,UAAU,CAAC6B,OAAO,CAACD,OAAO,CAACE,UAAU,CAAC7B,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;EAExE,MAAM8B,UAAU,GAAG,IAAIhC,SAAS,CAAC,CAAC;EAClC,MAAMiC,cAAc,GAAG,EAAE;EACzBN,QAAQ,CAACO,OAAO,CAAEL,OAAO,IAAK;IAC5B,MAAMM,SAAS,GAAGN,OAAO,CAACE,UAAU,CAACP,EAAE;IACvC,IAAIQ,UAAU,CAACI,GAAG,CAACD,SAAS,CAAC,EAAE;IAC/BH,UAAU,CAACK,GAAG,CAACF,SAAS,CAAC;IACzBF,cAAc,CAACK,IAAI,CAACT,OAAO,CAAC;EAC9B,CAAC,CAAC;EAEF,OAAOhC,YAAY,CAACoC,cAAc,CAAC;AACrC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
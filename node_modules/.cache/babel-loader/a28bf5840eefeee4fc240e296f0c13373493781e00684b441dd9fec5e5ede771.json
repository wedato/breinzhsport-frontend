{"ast":null,"code":"import { __assign, __awaiter, __generator, __read, __rest } from \"tslib\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { print, parse, GraphQLError } from 'graphql';\nimport { Amplify, ConsoleLogger as Logger, Credentials, getAmplifyUserAgent, INTERNAL_AWS_APPSYNC_REALTIME_PUBSUB_PROVIDER } from '@aws-amplify/core';\nimport { InternalPubSub } from '@aws-amplify/pubsub/internals';\nimport { Auth } from '@aws-amplify/auth';\nimport { Cache } from '@aws-amplify/cache';\nimport { GraphQLAuthError } from '../types';\nimport { RestClient } from '@aws-amplify/api-rest';\nvar USER_AGENT_HEADER = 'x-amz-user-agent';\nvar logger = new Logger('GraphQLAPI');\nexport var graphqlOperation = function (query, variables, authToken) {\n  if (variables === void 0) {\n    variables = {};\n  }\n  return {\n    query: query,\n    variables: variables,\n    authToken: authToken\n  };\n};\n/**\n * Export Cloud Logic APIs\n */\nvar InternalGraphQLAPIClass = /** @class */function () {\n  /**\n   * Initialize GraphQL API with AWS configuration\n   * @param {Object} options - Configuration object for API\n   */\n  function InternalGraphQLAPIClass(options) {\n    this._api = null;\n    this.Auth = Auth;\n    this.Cache = Cache;\n    this.Credentials = Credentials;\n    this._options = options;\n    logger.debug('API Options', this._options);\n  }\n  InternalGraphQLAPIClass.prototype.getModuleName = function () {\n    return 'InternalGraphQLAPI';\n  };\n  /**\n   * Configure API\n   * @param {Object} config - Configuration of the API\n   * @return {Object} - The current configuration\n   */\n  InternalGraphQLAPIClass.prototype.configure = function (options) {\n    var _a = options || {},\n      _b = _a.API,\n      API = _b === void 0 ? {} : _b,\n      otherOptions = __rest(_a, [\"API\"]);\n    var opt = __assign(__assign({}, otherOptions), API);\n    logger.debug('configure GraphQL API', {\n      opt: opt\n    });\n    if (opt['aws_project_region']) {\n      opt = Object.assign({}, opt, {\n        region: opt['aws_project_region'],\n        header: {}\n      });\n    }\n    if (typeof opt.graphql_headers !== 'undefined' && typeof opt.graphql_headers !== 'function') {\n      logger.warn('graphql_headers should be a function');\n      opt.graphql_headers = undefined;\n    }\n    this._options = Object.assign({}, this._options, opt);\n    this.createInstance();\n    return this._options;\n  };\n  /**\n   * Create an instance of API for the library\n   * @return - A promise of true if Success\n   */\n  InternalGraphQLAPIClass.prototype.createInstance = function () {\n    logger.debug('create Rest instance');\n    if (this._options) {\n      this._api = new RestClient(this._options);\n      // Share instance Credentials with client for SSR\n      this._api.Credentials = this.Credentials;\n      return true;\n    } else {\n      return Promise.reject('API not configured');\n    }\n  };\n  InternalGraphQLAPIClass.prototype._headerBasedAuth = function (defaultAuthenticationType, additionalHeaders) {\n    if (additionalHeaders === void 0) {\n      additionalHeaders = {};\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, aws_appsync_authenticationType, apiKey, authenticationType, headers, _b, credentialsOK, token, federatedInfo, currentUser, e_1, session, e_2;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            _a = this._options, aws_appsync_authenticationType = _a.aws_appsync_authenticationType, apiKey = _a.aws_appsync_apiKey;\n            authenticationType = defaultAuthenticationType || aws_appsync_authenticationType || 'AWS_IAM';\n            headers = {};\n            _b = authenticationType;\n            switch (_b) {\n              case 'API_KEY':\n                return [3 /*break*/, 1];\n              case 'AWS_IAM':\n                return [3 /*break*/, 2];\n              case 'OPENID_CONNECT':\n                return [3 /*break*/, 4];\n              case 'AMAZON_COGNITO_USER_POOLS':\n                return [3 /*break*/, 11];\n              case 'AWS_LAMBDA':\n                return [3 /*break*/, 15];\n            }\n            return [3 /*break*/, 16];\n          case 1:\n            if (!apiKey) {\n              throw new Error(GraphQLAuthError.NO_API_KEY);\n            }\n            headers = {\n              Authorization: null,\n              'X-Api-Key': apiKey\n            };\n            return [3 /*break*/, 17];\n          case 2:\n            return [4 /*yield*/, this._ensureCredentials()];\n          case 3:\n            credentialsOK = _c.sent();\n            if (!credentialsOK) {\n              throw new Error(GraphQLAuthError.NO_CREDENTIALS);\n            }\n            return [3 /*break*/, 17];\n          case 4:\n            _c.trys.push([4, 9,, 10]);\n            token = void 0;\n            return [4 /*yield*/, Cache.getItem('federatedInfo')];\n          case 5:\n            federatedInfo = _c.sent();\n            if (!federatedInfo) return [3 /*break*/, 6];\n            token = federatedInfo.token;\n            return [3 /*break*/, 8];\n          case 6:\n            return [4 /*yield*/, Auth.currentAuthenticatedUser()];\n          case 7:\n            currentUser = _c.sent();\n            if (currentUser) {\n              token = currentUser.token;\n            }\n            _c.label = 8;\n          case 8:\n            if (!token) {\n              throw new Error(GraphQLAuthError.NO_FEDERATED_JWT);\n            }\n            headers = {\n              Authorization: token\n            };\n            return [3 /*break*/, 10];\n          case 9:\n            e_1 = _c.sent();\n            throw new Error(GraphQLAuthError.NO_CURRENT_USER);\n          case 10:\n            return [3 /*break*/, 17];\n          case 11:\n            _c.trys.push([11, 13,, 14]);\n            return [4 /*yield*/, this.Auth.currentSession()];\n          case 12:\n            session = _c.sent();\n            headers = {\n              Authorization: session.getAccessToken().getJwtToken()\n            };\n            return [3 /*break*/, 14];\n          case 13:\n            e_2 = _c.sent();\n            throw new Error(GraphQLAuthError.NO_CURRENT_USER);\n          case 14:\n            return [3 /*break*/, 17];\n          case 15:\n            if (!additionalHeaders.Authorization) {\n              throw new Error(GraphQLAuthError.NO_AUTH_TOKEN);\n            }\n            headers = {\n              Authorization: additionalHeaders.Authorization\n            };\n            return [3 /*break*/, 17];\n          case 16:\n            headers = {\n              Authorization: null\n            };\n            return [3 /*break*/, 17];\n          case 17:\n            return [2 /*return*/, headers];\n        }\n      });\n    });\n  };\n  /**\n   * to get the operation type\n   * @param operation\n   */\n  InternalGraphQLAPIClass.prototype.getGraphqlOperationType = function (operation) {\n    var doc = parse(operation);\n    var definitions = doc.definitions;\n    var _a = __read(definitions, 1),\n      operationType = _a[0].operation;\n    return operationType;\n  };\n  /**\n   * Executes a GraphQL operation\n   *\n   * @param options - GraphQL Options\n   * @param [additionalHeaders] - headers to merge in after any `graphql_headers` set in the config\n   * @returns An Observable if the query is a subscription query, else a promise of the graphql result.\n   */\n  InternalGraphQLAPIClass.prototype.graphql = function (_a, additionalHeaders, customUserAgentDetails) {\n    var paramQuery = _a.query,\n      _b = _a.variables,\n      variables = _b === void 0 ? {} : _b,\n      authMode = _a.authMode,\n      authToken = _a.authToken;\n    var query = typeof paramQuery === 'string' ? parse(paramQuery) : parse(print(paramQuery));\n    var _c = __read(query.definitions.filter(function (def) {\n        return def.kind === 'OperationDefinition';\n      }), 1),\n      _d = _c[0],\n      operationDef = _d === void 0 ? {} : _d;\n    var operationType = operationDef.operation;\n    var headers = additionalHeaders || {};\n    // if an authorization header is set, have the explicit authToken take precedence\n    if (authToken) {\n      headers.Authorization = authToken;\n    }\n    switch (operationType) {\n      case 'query':\n      case 'mutation':\n        this.createInstanceIfNotCreated();\n        var cancellableToken = this._api.getCancellableToken();\n        var initParams = {\n          cancellableToken: cancellableToken,\n          withCredentials: this._options.withCredentials\n        };\n        var responsePromise = this._graphql({\n          query: query,\n          variables: variables,\n          authMode: authMode\n        }, headers, initParams, customUserAgentDetails);\n        this._api.updateRequestToBeCancellable(responsePromise, cancellableToken);\n        return responsePromise;\n      case 'subscription':\n        return this._graphqlSubscribe({\n          query: query,\n          variables: variables,\n          authMode: authMode\n        }, headers, customUserAgentDetails);\n      default:\n        throw new Error(\"invalid operation type: \".concat(operationType));\n    }\n  };\n  InternalGraphQLAPIClass.prototype._graphql = function (_a, additionalHeaders, initParams, customUserAgentDetails) {\n    var query = _a.query,\n      variables = _a.variables,\n      authMode = _a.authMode;\n    if (additionalHeaders === void 0) {\n      additionalHeaders = {};\n    }\n    if (initParams === void 0) {\n      initParams = {};\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var _b, region, appSyncGraphqlEndpoint, _c, graphql_headers, customGraphqlEndpoint, customEndpointRegion, headers, _d, _e, _f, _g, _h, _j, body, init, endpoint, error, response, err_1, errors;\n      var _k;\n      return __generator(this, function (_l) {\n        switch (_l.label) {\n          case 0:\n            this.createInstanceIfNotCreated();\n            _b = this._options, region = _b.aws_appsync_region, appSyncGraphqlEndpoint = _b.aws_appsync_graphqlEndpoint, _c = _b.graphql_headers, graphql_headers = _c === void 0 ? function () {\n              return {};\n            } : _c, customGraphqlEndpoint = _b.graphql_endpoint, customEndpointRegion = _b.graphql_endpoint_iam_region;\n            _d = [{}];\n            _e = !customGraphqlEndpoint;\n            if (!_e) return [3 /*break*/, 2];\n            return [4 /*yield*/, this._headerBasedAuth(authMode, additionalHeaders)];\n          case 1:\n            _e = _l.sent();\n            _l.label = 2;\n          case 2:\n            _f = [__assign.apply(void 0, _d.concat([_e]))];\n            _g = customGraphqlEndpoint;\n            if (!_g) return [3 /*break*/, 6];\n            if (!customEndpointRegion) return [3 /*break*/, 4];\n            return [4 /*yield*/, this._headerBasedAuth(authMode, additionalHeaders)];\n          case 3:\n            _h = _l.sent();\n            return [3 /*break*/, 5];\n          case 4:\n            _h = {\n              Authorization: null\n            };\n            _l.label = 5;\n          case 5:\n            _g = _h;\n            _l.label = 6;\n          case 6:\n            _j = [__assign.apply(void 0, _f.concat([_g]))];\n            return [4 /*yield*/, graphql_headers({\n              query: query,\n              variables: variables\n            })];\n          case 7:\n            headers = __assign.apply(void 0, [__assign.apply(void 0, [__assign.apply(void 0, _j.concat([_l.sent()])), additionalHeaders]), !customGraphqlEndpoint && (_k = {}, _k[USER_AGENT_HEADER] = getAmplifyUserAgent(customUserAgentDetails), _k)]);\n            body = {\n              query: print(query),\n              variables: variables\n            };\n            init = Object.assign({\n              headers: headers,\n              body: body,\n              signerServiceInfo: {\n                service: !customGraphqlEndpoint ? 'appsync' : 'execute-api',\n                region: !customGraphqlEndpoint ? region : customEndpointRegion\n              }\n            }, initParams);\n            endpoint = customGraphqlEndpoint || appSyncGraphqlEndpoint;\n            if (!endpoint) {\n              error = new GraphQLError('No graphql endpoint provided.');\n              throw {\n                data: {},\n                errors: [error]\n              };\n            }\n            _l.label = 8;\n          case 8:\n            _l.trys.push([8, 10,, 11]);\n            return [4 /*yield*/, this._api.post(endpoint, init)];\n          case 9:\n            response = _l.sent();\n            return [3 /*break*/, 11];\n          case 10:\n            err_1 = _l.sent();\n            // If the exception is because user intentionally\n            // cancelled the request, do not modify the exception\n            // so that clients can identify the exception correctly.\n            if (this._api.isCancel(err_1)) {\n              throw err_1;\n            }\n            response = {\n              data: {},\n              errors: [new GraphQLError(err_1.message, null, null, null, null, err_1)]\n            };\n            return [3 /*break*/, 11];\n          case 11:\n            errors = response.errors;\n            if (errors && errors.length) {\n              throw response;\n            }\n            return [2 /*return*/, response];\n        }\n      });\n    });\n  };\n  InternalGraphQLAPIClass.prototype.createInstanceIfNotCreated = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!!this._api) return [3 /*break*/, 2];\n            return [4 /*yield*/, this.createInstance()];\n          case 1:\n            _a.sent();\n            _a.label = 2;\n          case 2:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /**\n   * Checks to see if an error thrown is from an api request cancellation\n   * @param {any} error - Any error\n   * @return {boolean} - A boolean indicating if the error was from an api request cancellation\n   */\n  InternalGraphQLAPIClass.prototype.isCancel = function (error) {\n    return this._api.isCancel(error);\n  };\n  /**\n   * Cancels an inflight request. Only applicable for graphql queries and mutations\n   * @param {any} request - request to cancel\n   * @return {boolean} - A boolean indicating if the request was cancelled\n   */\n  InternalGraphQLAPIClass.prototype.cancel = function (request, message) {\n    return this._api.cancel(request, message);\n  };\n  /**\n   * Check if the request has a corresponding cancel token in the WeakMap.\n   * @params request - The request promise\n   * @return if the request has a corresponding cancel token.\n   */\n  InternalGraphQLAPIClass.prototype.hasCancelToken = function (request) {\n    return this._api.hasCancelToken(request);\n  };\n  InternalGraphQLAPIClass.prototype._graphqlSubscribe = function (_a, additionalHeaders, customUserAgentDetails) {\n    var query = _a.query,\n      variables = _a.variables,\n      defaultAuthenticationType = _a.authMode,\n      authToken = _a.authToken;\n    if (additionalHeaders === void 0) {\n      additionalHeaders = {};\n    }\n    var _b = this._options,\n      region = _b.aws_appsync_region,\n      appSyncGraphqlEndpoint = _b.aws_appsync_graphqlEndpoint,\n      aws_appsync_authenticationType = _b.aws_appsync_authenticationType,\n      apiKey = _b.aws_appsync_apiKey,\n      _c = _b.graphql_headers,\n      graphql_headers = _c === void 0 ? function () {\n        return {};\n      } : _c;\n    var authenticationType = defaultAuthenticationType || aws_appsync_authenticationType || 'AWS_IAM';\n    if (InternalPubSub && typeof InternalPubSub.subscribe === 'function') {\n      return InternalPubSub.subscribe('', {\n        provider: INTERNAL_AWS_APPSYNC_REALTIME_PUBSUB_PROVIDER,\n        appSyncGraphqlEndpoint: appSyncGraphqlEndpoint,\n        authenticationType: authenticationType,\n        apiKey: apiKey,\n        query: print(query),\n        region: region,\n        variables: variables,\n        graphql_headers: graphql_headers,\n        additionalHeaders: additionalHeaders,\n        authToken: authToken\n      }, customUserAgentDetails);\n    } else {\n      logger.debug('No pubsub module applied for subscription');\n      throw new Error('No pubsub module applied for subscription');\n    }\n  };\n  /**\n   * @private\n   */\n  InternalGraphQLAPIClass.prototype._ensureCredentials = function () {\n    var _this = this;\n    return this.Credentials.get().then(function (credentials) {\n      if (!credentials) return false;\n      var cred = _this.Credentials.shear(credentials);\n      logger.debug('set credentials for api', cred);\n      return true;\n    }).catch(function (err) {\n      logger.warn('ensure credentials error', err);\n      return false;\n    });\n  };\n  return InternalGraphQLAPIClass;\n}();\nexport { InternalGraphQLAPIClass };\nexport var InternalGraphQLAPI = new InternalGraphQLAPIClass(null);\nAmplify.register(InternalGraphQLAPI);","map":{"version":3,"names":["__assign","__awaiter","__generator","__read","__rest","print","parse","GraphQLError","Amplify","ConsoleLogger","Logger","Credentials","getAmplifyUserAgent","INTERNAL_AWS_APPSYNC_REALTIME_PUBSUB_PROVIDER","InternalPubSub","Auth","Cache","GraphQLAuthError","RestClient","USER_AGENT_HEADER","logger","graphqlOperation","query","variables","authToken","InternalGraphQLAPIClass","options","_api","_options","debug","prototype","getModuleName","configure","_a","_b","API","otherOptions","opt","Object","assign","region","header","graphql_headers","warn","undefined","createInstance","Promise","reject","_headerBasedAuth","defaultAuthenticationType","additionalHeaders","aws_appsync_authenticationType","apiKey","authenticationType","headers","credentialsOK","token","federatedInfo","currentUser","e_1","session","e_2","_c","label","aws_appsync_apiKey","Error","NO_API_KEY","Authorization","_ensureCredentials","sent","NO_CREDENTIALS","trys","push","getItem","currentAuthenticatedUser","NO_FEDERATED_JWT","NO_CURRENT_USER","currentSession","getAccessToken","getJwtToken","NO_AUTH_TOKEN","getGraphqlOperationType","operation","doc","definitions","operationType","graphql","customUserAgentDetails","paramQuery","authMode","filter","def","kind","_d","operationDef","createInstanceIfNotCreated","cancellableToken","getCancellableToken","initParams","withCredentials","responsePromise","_graphql","updateRequestToBeCancellable","_graphqlSubscribe","concat","appSyncGraphqlEndpoint","customGraphqlEndpoint","customEndpointRegion","_e","_f","_g","_h","_j","body","init","endpoint","error","response","err_1","errors","_k","_l","aws_appsync_region","aws_appsync_graphqlEndpoint","graphql_endpoint","graphql_endpoint_iam_region","apply","signerServiceInfo","service","data","post","isCancel","message","length","cancel","request","hasCancelToken","subscribe","provider","_this","get","then","credentials","cred","shear","catch","err","InternalGraphQLAPI","register"],"sources":["C:/Users/jonat/aws_poc/frontend/node_modules/@aws-amplify/api-graphql/lib-esm/internals/InternalGraphQLAPI.js"],"sourcesContent":["import { __assign, __awaiter, __generator, __read, __rest } from \"tslib\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { print, parse, GraphQLError, } from 'graphql';\nimport { Amplify, ConsoleLogger as Logger, Credentials, getAmplifyUserAgent, INTERNAL_AWS_APPSYNC_REALTIME_PUBSUB_PROVIDER, } from '@aws-amplify/core';\nimport { InternalPubSub } from '@aws-amplify/pubsub/internals';\nimport { Auth } from '@aws-amplify/auth';\nimport { Cache } from '@aws-amplify/cache';\nimport { GraphQLAuthError, } from '../types';\nimport { RestClient } from '@aws-amplify/api-rest';\nvar USER_AGENT_HEADER = 'x-amz-user-agent';\nvar logger = new Logger('GraphQLAPI');\nexport var graphqlOperation = function (query, variables, authToken) {\n    if (variables === void 0) { variables = {}; }\n    return ({\n        query: query,\n        variables: variables,\n        authToken: authToken,\n    });\n};\n/**\n * Export Cloud Logic APIs\n */\nvar InternalGraphQLAPIClass = /** @class */ (function () {\n    /**\n     * Initialize GraphQL API with AWS configuration\n     * @param {Object} options - Configuration object for API\n     */\n    function InternalGraphQLAPIClass(options) {\n        this._api = null;\n        this.Auth = Auth;\n        this.Cache = Cache;\n        this.Credentials = Credentials;\n        this._options = options;\n        logger.debug('API Options', this._options);\n    }\n    InternalGraphQLAPIClass.prototype.getModuleName = function () {\n        return 'InternalGraphQLAPI';\n    };\n    /**\n     * Configure API\n     * @param {Object} config - Configuration of the API\n     * @return {Object} - The current configuration\n     */\n    InternalGraphQLAPIClass.prototype.configure = function (options) {\n        var _a = options || {}, _b = _a.API, API = _b === void 0 ? {} : _b, otherOptions = __rest(_a, [\"API\"]);\n        var opt = __assign(__assign({}, otherOptions), API);\n        logger.debug('configure GraphQL API', { opt: opt });\n        if (opt['aws_project_region']) {\n            opt = Object.assign({}, opt, {\n                region: opt['aws_project_region'],\n                header: {},\n            });\n        }\n        if (typeof opt.graphql_headers !== 'undefined' &&\n            typeof opt.graphql_headers !== 'function') {\n            logger.warn('graphql_headers should be a function');\n            opt.graphql_headers = undefined;\n        }\n        this._options = Object.assign({}, this._options, opt);\n        this.createInstance();\n        return this._options;\n    };\n    /**\n     * Create an instance of API for the library\n     * @return - A promise of true if Success\n     */\n    InternalGraphQLAPIClass.prototype.createInstance = function () {\n        logger.debug('create Rest instance');\n        if (this._options) {\n            this._api = new RestClient(this._options);\n            // Share instance Credentials with client for SSR\n            this._api.Credentials = this.Credentials;\n            return true;\n        }\n        else {\n            return Promise.reject('API not configured');\n        }\n    };\n    InternalGraphQLAPIClass.prototype._headerBasedAuth = function (defaultAuthenticationType, additionalHeaders) {\n        if (additionalHeaders === void 0) { additionalHeaders = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, aws_appsync_authenticationType, apiKey, authenticationType, headers, _b, credentialsOK, token, federatedInfo, currentUser, e_1, session, e_2;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = this._options, aws_appsync_authenticationType = _a.aws_appsync_authenticationType, apiKey = _a.aws_appsync_apiKey;\n                        authenticationType = defaultAuthenticationType || aws_appsync_authenticationType || 'AWS_IAM';\n                        headers = {};\n                        _b = authenticationType;\n                        switch (_b) {\n                            case 'API_KEY': return [3 /*break*/, 1];\n                            case 'AWS_IAM': return [3 /*break*/, 2];\n                            case 'OPENID_CONNECT': return [3 /*break*/, 4];\n                            case 'AMAZON_COGNITO_USER_POOLS': return [3 /*break*/, 11];\n                            case 'AWS_LAMBDA': return [3 /*break*/, 15];\n                        }\n                        return [3 /*break*/, 16];\n                    case 1:\n                        if (!apiKey) {\n                            throw new Error(GraphQLAuthError.NO_API_KEY);\n                        }\n                        headers = {\n                            Authorization: null,\n                            'X-Api-Key': apiKey,\n                        };\n                        return [3 /*break*/, 17];\n                    case 2: return [4 /*yield*/, this._ensureCredentials()];\n                    case 3:\n                        credentialsOK = _c.sent();\n                        if (!credentialsOK) {\n                            throw new Error(GraphQLAuthError.NO_CREDENTIALS);\n                        }\n                        return [3 /*break*/, 17];\n                    case 4:\n                        _c.trys.push([4, 9, , 10]);\n                        token = void 0;\n                        return [4 /*yield*/, Cache.getItem('federatedInfo')];\n                    case 5:\n                        federatedInfo = _c.sent();\n                        if (!federatedInfo) return [3 /*break*/, 6];\n                        token = federatedInfo.token;\n                        return [3 /*break*/, 8];\n                    case 6: return [4 /*yield*/, Auth.currentAuthenticatedUser()];\n                    case 7:\n                        currentUser = _c.sent();\n                        if (currentUser) {\n                            token = currentUser.token;\n                        }\n                        _c.label = 8;\n                    case 8:\n                        if (!token) {\n                            throw new Error(GraphQLAuthError.NO_FEDERATED_JWT);\n                        }\n                        headers = {\n                            Authorization: token,\n                        };\n                        return [3 /*break*/, 10];\n                    case 9:\n                        e_1 = _c.sent();\n                        throw new Error(GraphQLAuthError.NO_CURRENT_USER);\n                    case 10: return [3 /*break*/, 17];\n                    case 11:\n                        _c.trys.push([11, 13, , 14]);\n                        return [4 /*yield*/, this.Auth.currentSession()];\n                    case 12:\n                        session = _c.sent();\n                        headers = {\n                            Authorization: session.getAccessToken().getJwtToken(),\n                        };\n                        return [3 /*break*/, 14];\n                    case 13:\n                        e_2 = _c.sent();\n                        throw new Error(GraphQLAuthError.NO_CURRENT_USER);\n                    case 14: return [3 /*break*/, 17];\n                    case 15:\n                        if (!additionalHeaders.Authorization) {\n                            throw new Error(GraphQLAuthError.NO_AUTH_TOKEN);\n                        }\n                        headers = {\n                            Authorization: additionalHeaders.Authorization,\n                        };\n                        return [3 /*break*/, 17];\n                    case 16:\n                        headers = {\n                            Authorization: null,\n                        };\n                        return [3 /*break*/, 17];\n                    case 17: return [2 /*return*/, headers];\n                }\n            });\n        });\n    };\n    /**\n     * to get the operation type\n     * @param operation\n     */\n    InternalGraphQLAPIClass.prototype.getGraphqlOperationType = function (operation) {\n        var doc = parse(operation);\n        var definitions = doc.definitions;\n        var _a = __read(definitions, 1), operationType = _a[0].operation;\n        return operationType;\n    };\n    /**\n     * Executes a GraphQL operation\n     *\n     * @param options - GraphQL Options\n     * @param [additionalHeaders] - headers to merge in after any `graphql_headers` set in the config\n     * @returns An Observable if the query is a subscription query, else a promise of the graphql result.\n     */\n    InternalGraphQLAPIClass.prototype.graphql = function (_a, additionalHeaders, customUserAgentDetails) {\n        var paramQuery = _a.query, _b = _a.variables, variables = _b === void 0 ? {} : _b, authMode = _a.authMode, authToken = _a.authToken;\n        var query = typeof paramQuery === 'string'\n            ? parse(paramQuery)\n            : parse(print(paramQuery));\n        var _c = __read(query.definitions.filter(function (def) { return def.kind === 'OperationDefinition'; }), 1), _d = _c[0], operationDef = _d === void 0 ? {} : _d;\n        var operationType = operationDef.operation;\n        var headers = additionalHeaders || {};\n        // if an authorization header is set, have the explicit authToken take precedence\n        if (authToken) {\n            headers.Authorization = authToken;\n        }\n        switch (operationType) {\n            case 'query':\n            case 'mutation':\n                this.createInstanceIfNotCreated();\n                var cancellableToken = this._api.getCancellableToken();\n                var initParams = {\n                    cancellableToken: cancellableToken,\n                    withCredentials: this._options.withCredentials,\n                };\n                var responsePromise = this._graphql({ query: query, variables: variables, authMode: authMode }, headers, initParams, customUserAgentDetails);\n                this._api.updateRequestToBeCancellable(responsePromise, cancellableToken);\n                return responsePromise;\n            case 'subscription':\n                return this._graphqlSubscribe({ query: query, variables: variables, authMode: authMode }, headers, customUserAgentDetails);\n            default:\n                throw new Error(\"invalid operation type: \".concat(operationType));\n        }\n    };\n    InternalGraphQLAPIClass.prototype._graphql = function (_a, additionalHeaders, initParams, customUserAgentDetails) {\n        var query = _a.query, variables = _a.variables, authMode = _a.authMode;\n        if (additionalHeaders === void 0) { additionalHeaders = {}; }\n        if (initParams === void 0) { initParams = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var _b, region, appSyncGraphqlEndpoint, _c, graphql_headers, customGraphqlEndpoint, customEndpointRegion, headers, _d, _e, _f, _g, _h, _j, body, init, endpoint, error, response, err_1, errors;\n            var _k;\n            return __generator(this, function (_l) {\n                switch (_l.label) {\n                    case 0:\n                        this.createInstanceIfNotCreated();\n                        _b = this._options, region = _b.aws_appsync_region, appSyncGraphqlEndpoint = _b.aws_appsync_graphqlEndpoint, _c = _b.graphql_headers, graphql_headers = _c === void 0 ? function () { return ({}); } : _c, customGraphqlEndpoint = _b.graphql_endpoint, customEndpointRegion = _b.graphql_endpoint_iam_region;\n                        _d = [{}];\n                        _e = !customGraphqlEndpoint;\n                        if (!_e) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this._headerBasedAuth(authMode, additionalHeaders)];\n                    case 1:\n                        _e = (_l.sent());\n                        _l.label = 2;\n                    case 2:\n                        _f = [__assign.apply(void 0, _d.concat([(_e)]))];\n                        _g = customGraphqlEndpoint;\n                        if (!_g) return [3 /*break*/, 6];\n                        if (!customEndpointRegion) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this._headerBasedAuth(authMode, additionalHeaders)];\n                    case 3:\n                        _h = _l.sent();\n                        return [3 /*break*/, 5];\n                    case 4:\n                        _h = { Authorization: null };\n                        _l.label = 5;\n                    case 5:\n                        _g = (_h);\n                        _l.label = 6;\n                    case 6:\n                        _j = [__assign.apply(void 0, _f.concat([(_g)]))];\n                        return [4 /*yield*/, graphql_headers({ query: query, variables: variables })];\n                    case 7:\n                        headers = __assign.apply(void 0, [__assign.apply(void 0, [__assign.apply(void 0, _j.concat([(_l.sent())])), additionalHeaders]), (!customGraphqlEndpoint && (_k = {},\n                                _k[USER_AGENT_HEADER] = getAmplifyUserAgent(customUserAgentDetails),\n                                _k))]);\n                        body = {\n                            query: print(query),\n                            variables: variables,\n                        };\n                        init = Object.assign({\n                            headers: headers,\n                            body: body,\n                            signerServiceInfo: {\n                                service: !customGraphqlEndpoint ? 'appsync' : 'execute-api',\n                                region: !customGraphqlEndpoint ? region : customEndpointRegion,\n                            },\n                        }, initParams);\n                        endpoint = customGraphqlEndpoint || appSyncGraphqlEndpoint;\n                        if (!endpoint) {\n                            error = new GraphQLError('No graphql endpoint provided.');\n                            throw {\n                                data: {},\n                                errors: [error],\n                            };\n                        }\n                        _l.label = 8;\n                    case 8:\n                        _l.trys.push([8, 10, , 11]);\n                        return [4 /*yield*/, this._api.post(endpoint, init)];\n                    case 9:\n                        response = _l.sent();\n                        return [3 /*break*/, 11];\n                    case 10:\n                        err_1 = _l.sent();\n                        // If the exception is because user intentionally\n                        // cancelled the request, do not modify the exception\n                        // so that clients can identify the exception correctly.\n                        if (this._api.isCancel(err_1)) {\n                            throw err_1;\n                        }\n                        response = {\n                            data: {},\n                            errors: [new GraphQLError(err_1.message, null, null, null, null, err_1)],\n                        };\n                        return [3 /*break*/, 11];\n                    case 11:\n                        errors = response.errors;\n                        if (errors && errors.length) {\n                            throw response;\n                        }\n                        return [2 /*return*/, response];\n                }\n            });\n        });\n    };\n    InternalGraphQLAPIClass.prototype.createInstanceIfNotCreated = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!!this._api) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.createInstance()];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Checks to see if an error thrown is from an api request cancellation\n     * @param {any} error - Any error\n     * @return {boolean} - A boolean indicating if the error was from an api request cancellation\n     */\n    InternalGraphQLAPIClass.prototype.isCancel = function (error) {\n        return this._api.isCancel(error);\n    };\n    /**\n     * Cancels an inflight request. Only applicable for graphql queries and mutations\n     * @param {any} request - request to cancel\n     * @return {boolean} - A boolean indicating if the request was cancelled\n     */\n    InternalGraphQLAPIClass.prototype.cancel = function (request, message) {\n        return this._api.cancel(request, message);\n    };\n    /**\n     * Check if the request has a corresponding cancel token in the WeakMap.\n     * @params request - The request promise\n     * @return if the request has a corresponding cancel token.\n     */\n    InternalGraphQLAPIClass.prototype.hasCancelToken = function (request) {\n        return this._api.hasCancelToken(request);\n    };\n    InternalGraphQLAPIClass.prototype._graphqlSubscribe = function (_a, additionalHeaders, customUserAgentDetails) {\n        var query = _a.query, variables = _a.variables, defaultAuthenticationType = _a.authMode, authToken = _a.authToken;\n        if (additionalHeaders === void 0) { additionalHeaders = {}; }\n        var _b = this._options, region = _b.aws_appsync_region, appSyncGraphqlEndpoint = _b.aws_appsync_graphqlEndpoint, aws_appsync_authenticationType = _b.aws_appsync_authenticationType, apiKey = _b.aws_appsync_apiKey, _c = _b.graphql_headers, graphql_headers = _c === void 0 ? function () { return ({}); } : _c;\n        var authenticationType = defaultAuthenticationType || aws_appsync_authenticationType || 'AWS_IAM';\n        if (InternalPubSub && typeof InternalPubSub.subscribe === 'function') {\n            return InternalPubSub.subscribe('', {\n                provider: INTERNAL_AWS_APPSYNC_REALTIME_PUBSUB_PROVIDER,\n                appSyncGraphqlEndpoint: appSyncGraphqlEndpoint,\n                authenticationType: authenticationType,\n                apiKey: apiKey,\n                query: print(query),\n                region: region,\n                variables: variables,\n                graphql_headers: graphql_headers,\n                additionalHeaders: additionalHeaders,\n                authToken: authToken,\n            }, customUserAgentDetails);\n        }\n        else {\n            logger.debug('No pubsub module applied for subscription');\n            throw new Error('No pubsub module applied for subscription');\n        }\n    };\n    /**\n     * @private\n     */\n    InternalGraphQLAPIClass.prototype._ensureCredentials = function () {\n        var _this = this;\n        return this.Credentials.get()\n            .then(function (credentials) {\n            if (!credentials)\n                return false;\n            var cred = _this.Credentials.shear(credentials);\n            logger.debug('set credentials for api', cred);\n            return true;\n        })\n            .catch(function (err) {\n            logger.warn('ensure credentials error', err);\n            return false;\n        });\n    };\n    return InternalGraphQLAPIClass;\n}());\nexport { InternalGraphQLAPIClass };\nexport var InternalGraphQLAPI = new InternalGraphQLAPIClass(null);\nAmplify.register(InternalGraphQLAPI);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
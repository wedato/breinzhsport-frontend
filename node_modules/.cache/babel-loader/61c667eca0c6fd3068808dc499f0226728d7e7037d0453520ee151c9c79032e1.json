{"ast":null,"code":"\"use strict\";\n\n/**\n * @module promise_p\n */\n/**\n * This module patches native Promise libraries provided by V8 engine\n * so all subsegments generated within Promise are attached to the correct parent.\n */\nconst contextUtils = require('../context_utils');\nconst originalThen = Symbol('original then');\nconst originalCatch = Symbol('original catch');\nfunction patchPromise(Promise) {\n  const then = Promise.prototype.then;\n  if (!then[originalThen]) {\n    Promise.prototype.then = function (onFulfilled, onRejected) {\n      if (contextUtils.isAutomaticMode() && tryGetCurrentSegment()) {\n        const ns = contextUtils.getNamespace();\n        onFulfilled = onFulfilled && ns.bind(onFulfilled);\n        onRejected = onRejected && ns.bind(onRejected);\n      }\n      return then.call(this, onFulfilled, onRejected);\n    };\n    Promise.prototype.then[originalThen] = then;\n  }\n  const origCatch = Promise.prototype.catch;\n  if (origCatch && !origCatch[originalCatch]) {\n    Promise.prototype.catch = function (onRejected) {\n      if (contextUtils.isAutomaticMode() && tryGetCurrentSegment()) {\n        const ns = contextUtils.getNamespace();\n        onRejected = onRejected && ns.bind(onRejected);\n      }\n      return origCatch.call(this, onRejected);\n    };\n    Promise.prototype.catch[originalCatch] = origCatch;\n  }\n}\nfunction unpatchPromise(Promise) {\n  const then = Promise.prototype.then;\n  if (then[originalThen]) {\n    Promise.prototype.then = then[originalThen];\n  }\n  const origCatch = Promise.prototype.catch;\n  if (origCatch && origCatch[originalCatch]) {\n    Promise.prototype.catch = origCatch[originalCatch];\n  }\n}\nfunction tryGetCurrentSegment() {\n  try {\n    return contextUtils.getSegment();\n  } catch (e) {\n    return undefined;\n  }\n}\nfunction capturePromise() {\n  patchPromise(Promise);\n}\nfunction uncapturePromise() {\n  unpatchPromise(Promise);\n}\ncapturePromise.patchThirdPartyPromise = patchPromise;\nmodule.exports.capturePromise = capturePromise;\nmodule.exports.uncapturePromise = uncapturePromise;","map":{"version":3,"names":["contextUtils","require","originalThen","Symbol","originalCatch","patchPromise","Promise","then","prototype","onFulfilled","onRejected","isAutomaticMode","tryGetCurrentSegment","ns","getNamespace","bind","call","origCatch","catch","unpatchPromise","getSegment","e","undefined","capturePromise","uncapturePromise","patchThirdPartyPromise","module","exports"],"sources":["C:/Users/jonat/aws_poc/frontend/node_modules/aws-xray-sdk-core/dist/lib/patchers/promise_p.js"],"sourcesContent":["\"use strict\";\n/**\n * @module promise_p\n */\n/**\n * This module patches native Promise libraries provided by V8 engine\n * so all subsegments generated within Promise are attached to the correct parent.\n */\nconst contextUtils = require('../context_utils');\nconst originalThen = Symbol('original then');\nconst originalCatch = Symbol('original catch');\nfunction patchPromise(Promise) {\n    const then = Promise.prototype.then;\n    if (!then[originalThen]) {\n        Promise.prototype.then = function (onFulfilled, onRejected) {\n            if (contextUtils.isAutomaticMode()\n                && tryGetCurrentSegment()) {\n                const ns = contextUtils.getNamespace();\n                onFulfilled = onFulfilled && ns.bind(onFulfilled);\n                onRejected = onRejected && ns.bind(onRejected);\n            }\n            return then.call(this, onFulfilled, onRejected);\n        };\n        Promise.prototype.then[originalThen] = then;\n    }\n    const origCatch = Promise.prototype.catch;\n    if (origCatch && !origCatch[originalCatch]) {\n        Promise.prototype.catch = function (onRejected) {\n            if (contextUtils.isAutomaticMode()\n                && tryGetCurrentSegment()) {\n                const ns = contextUtils.getNamespace();\n                onRejected = onRejected && ns.bind(onRejected);\n            }\n            return origCatch.call(this, onRejected);\n        };\n        Promise.prototype.catch[originalCatch] = origCatch;\n    }\n}\nfunction unpatchPromise(Promise) {\n    const then = Promise.prototype.then;\n    if (then[originalThen]) {\n        Promise.prototype.then = then[originalThen];\n    }\n    const origCatch = Promise.prototype.catch;\n    if (origCatch && origCatch[originalCatch]) {\n        Promise.prototype.catch = origCatch[originalCatch];\n    }\n}\nfunction tryGetCurrentSegment() {\n    try {\n        return contextUtils.getSegment();\n    }\n    catch (e) {\n        return undefined;\n    }\n}\nfunction capturePromise() {\n    patchPromise(Promise);\n}\nfunction uncapturePromise() {\n    unpatchPromise(Promise);\n}\ncapturePromise.patchThirdPartyPromise = patchPromise;\nmodule.exports.capturePromise = capturePromise;\nmodule.exports.uncapturePromise = uncapturePromise;\n"],"mappings":"AAAA,YAAY;;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMA,YAAY,GAAGC,OAAO,CAAC,kBAAkB,CAAC;AAChD,MAAMC,YAAY,GAAGC,MAAM,CAAC,eAAe,CAAC;AAC5C,MAAMC,aAAa,GAAGD,MAAM,CAAC,gBAAgB,CAAC;AAC9C,SAASE,YAAYA,CAACC,OAAO,EAAE;EAC3B,MAAMC,IAAI,GAAGD,OAAO,CAACE,SAAS,CAACD,IAAI;EACnC,IAAI,CAACA,IAAI,CAACL,YAAY,CAAC,EAAE;IACrBI,OAAO,CAACE,SAAS,CAACD,IAAI,GAAG,UAAUE,WAAW,EAAEC,UAAU,EAAE;MACxD,IAAIV,YAAY,CAACW,eAAe,CAAC,CAAC,IAC3BC,oBAAoB,CAAC,CAAC,EAAE;QAC3B,MAAMC,EAAE,GAAGb,YAAY,CAACc,YAAY,CAAC,CAAC;QACtCL,WAAW,GAAGA,WAAW,IAAII,EAAE,CAACE,IAAI,CAACN,WAAW,CAAC;QACjDC,UAAU,GAAGA,UAAU,IAAIG,EAAE,CAACE,IAAI,CAACL,UAAU,CAAC;MAClD;MACA,OAAOH,IAAI,CAACS,IAAI,CAAC,IAAI,EAAEP,WAAW,EAAEC,UAAU,CAAC;IACnD,CAAC;IACDJ,OAAO,CAACE,SAAS,CAACD,IAAI,CAACL,YAAY,CAAC,GAAGK,IAAI;EAC/C;EACA,MAAMU,SAAS,GAAGX,OAAO,CAACE,SAAS,CAACU,KAAK;EACzC,IAAID,SAAS,IAAI,CAACA,SAAS,CAACb,aAAa,CAAC,EAAE;IACxCE,OAAO,CAACE,SAAS,CAACU,KAAK,GAAG,UAAUR,UAAU,EAAE;MAC5C,IAAIV,YAAY,CAACW,eAAe,CAAC,CAAC,IAC3BC,oBAAoB,CAAC,CAAC,EAAE;QAC3B,MAAMC,EAAE,GAAGb,YAAY,CAACc,YAAY,CAAC,CAAC;QACtCJ,UAAU,GAAGA,UAAU,IAAIG,EAAE,CAACE,IAAI,CAACL,UAAU,CAAC;MAClD;MACA,OAAOO,SAAS,CAACD,IAAI,CAAC,IAAI,EAAEN,UAAU,CAAC;IAC3C,CAAC;IACDJ,OAAO,CAACE,SAAS,CAACU,KAAK,CAACd,aAAa,CAAC,GAAGa,SAAS;EACtD;AACJ;AACA,SAASE,cAAcA,CAACb,OAAO,EAAE;EAC7B,MAAMC,IAAI,GAAGD,OAAO,CAACE,SAAS,CAACD,IAAI;EACnC,IAAIA,IAAI,CAACL,YAAY,CAAC,EAAE;IACpBI,OAAO,CAACE,SAAS,CAACD,IAAI,GAAGA,IAAI,CAACL,YAAY,CAAC;EAC/C;EACA,MAAMe,SAAS,GAAGX,OAAO,CAACE,SAAS,CAACU,KAAK;EACzC,IAAID,SAAS,IAAIA,SAAS,CAACb,aAAa,CAAC,EAAE;IACvCE,OAAO,CAACE,SAAS,CAACU,KAAK,GAAGD,SAAS,CAACb,aAAa,CAAC;EACtD;AACJ;AACA,SAASQ,oBAAoBA,CAAA,EAAG;EAC5B,IAAI;IACA,OAAOZ,YAAY,CAACoB,UAAU,CAAC,CAAC;EACpC,CAAC,CACD,OAAOC,CAAC,EAAE;IACN,OAAOC,SAAS;EACpB;AACJ;AACA,SAASC,cAAcA,CAAA,EAAG;EACtBlB,YAAY,CAACC,OAAO,CAAC;AACzB;AACA,SAASkB,gBAAgBA,CAAA,EAAG;EACxBL,cAAc,CAACb,OAAO,CAAC;AAC3B;AACAiB,cAAc,CAACE,sBAAsB,GAAGpB,YAAY;AACpDqB,MAAM,CAACC,OAAO,CAACJ,cAAc,GAAGA,cAAc;AAC9CG,MAAM,CAACC,OAAO,CAACH,gBAAgB,GAAGA,gBAAgB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}